<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Azenza IA - Diagnóstico Inteligente</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fuentes e Iconos -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Slate 900 */
            color: #e2e8f0; /* Slate 200 */
        }
        
        /* Efecto Glassmorphism sutil */
        .glass-panel {
            background: rgba(30, 41, 59, 0.7); /* Slate 800 con opacidad */
            backdrop-filter: blur(10px);
            border: 1px solid rgba(139, 92, 246, 0.1); /* Borde púrpura sutil */
        }

        /* Gradiente para textos y botones */
        .text-gradient {
            background: linear-gradient(to right, #c084fc, #818cf8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .btn-gradient {
            background: linear-gradient(135deg, #7c3aed 0%, #4f46e5 100%);
            transition: all 0.3s ease;
        }
        .btn-gradient:hover {
            box-shadow: 0 0 15px rgba(124, 58, 237, 0.5);
            transform: translateY(-2px);
        }

        /* Inputs personalizados */
        .tech-input {
            background-color: #1e293b; /* Slate 800 */
            border: 1px solid #334155; /* Slate 700 */
            color: white;
            transition: all 0.3s ease;
        }
        .tech-input:focus {
            border-color: #a78bfa; /* Purple 400 */
            outline: none;
            box-shadow: 0 0 0 3px rgba(167, 139, 250, 0.2);
        }

        /* Zona de carga */
        .drop-zone {
            border: 2px dashed #475569;
            transition: all 0.3s ease;
            background-color: rgba(30, 41, 59, 0.5);
        }
        .drop-zone:hover, .drop-zone.drag-over {
            border-color: #a78bfa;
            background-color: rgba(167, 139, 250, 0.1);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Fondo decorativo (Glow effects) -->
    <div class="fixed top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none">
        <div class="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-purple-900 rounded-full mix-blend-screen filter blur-[100px] opacity-20"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-indigo-900 rounded-full mix-blend-screen filter blur-[100px] opacity-20"></div>
    </div>

    <div class="container mx-auto p-4 md:p-8 max-w-5xl flex-grow">
        
        <!-- Encabezado -->
        <header class="text-center mb-10">
            <div class="inline-block p-2 px-4 rounded-full bg-slate-800 border border-slate-700 mb-4 text-xs font-bold tracking-widest text-purple-400 uppercase">
                <i class="fas fa-robot mr-2"></i>Beta v3.0
            </div>
            <h1 class="text-4xl md:text-5xl font-bold mb-4">
                <span class="text-gradient">Azenza IA</span>
            </h1>
            <p class="text-lg text-slate-400 max-w-2xl mx-auto">
                Auditoría de marca inteligente. Comparamos tu estrategia interna con lo que realmente proyecta tu perfil.
            </p>
        </header>

        <!-- Contenedor Principal (Grid para Desktop) -->
        <div id="main-interface" class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Columna Izquierda: Inputs de Estrategia -->
            <div class="space-y-6">
                <div class="glass-panel p-6 rounded-2xl shadow-xl">
                    <h2 class="text-xl font-bold text-white mb-4 flex items-center">
                        <i class="fas fa-bullseye text-purple-400 mr-3"></i>Tu Estrategia
                    </h2>
                    <p class="text-sm text-slate-400 mb-6">Define tu marca para que la IA contraste tu intención con la realidad.</p>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-1">1. ¿Qué problema resuelves?</label>
                            <textarea id="input-problem" rows="2" class="tech-input w-full rounded-lg p-3 text-sm" placeholder="Ej: Ayudo a pymes a automatizar sus ventas..."></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-1">2. Diferenciación (Tu salsa secreta)</label>
                            <textarea id="input-diff" rows="2" class="tech-input w-full rounded-lg p-3 text-sm" placeholder="Ej: Usamos IA personalizada, no plantillas genéricas..."></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-1">3. Público Objetivo</label>
                            <input type="text" id="input-target" class="tech-input w-full rounded-lg p-3 text-sm" placeholder="Ej: Dueños de restaurantes de lujo...">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Columna Derecha: Carga de Imagen y Acción -->
            <div class="space-y-6">
                <div class="glass-panel p-6 rounded-2xl shadow-xl h-full flex flex-col">
                    <h2 class="text-xl font-bold text-white mb-4 flex items-center">
                        <i class="fas fa-image text-indigo-400 mr-3"></i>Evidencia Visual
                    </h2>
                    
                    <!-- Drop Zone -->
                    <div id="drop-zone" class="drop-zone flex-grow rounded-xl flex flex-col items-center justify-center p-8 cursor-pointer relative overflow-hidden group min-h-[250px]">
                        <input type="file" id="file-input" class="hidden" accept="image/png, image/jpeg, image/webp">
                        
                        <!-- Contenido por defecto -->
                        <div id="drop-content" class="text-center transition-opacity duration-300">
                            <div class="w-16 h-16 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                                <i class="fas fa-cloud-upload-alt text-3xl text-purple-400"></i>
                            </div>
                            <p class="font-semibold text-slate-200">Sube tu captura aquí</p>
                            <p class="text-xs text-slate-500 mt-2">Instagram o Facebook</p>
                        </div>

                        <!-- Preview de imagen (oculto inicialmente) -->
                        <img id="image-preview" src="#" class="absolute inset-0 w-full h-full object-contain bg-slate-900 hidden opacity-0 transition-opacity duration-500" alt="Preview">
                        
                        <!-- Botón flotante para cambiar imagen (solo visible con imagen) -->
                        <button id="change-image-btn" class="absolute top-2 right-2 bg-slate-800 text-white p-2 rounded-full text-xs hover:bg-red-500 transition hidden z-10">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <!-- Botón de Acción -->
                    <button id="analyze-button" class="btn-gradient w-full mt-6 py-4 rounded-xl font-bold text-white shadow-lg flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none group">
                        <span>Ejecutar Diagnóstico</span>
                        <i class="fas fa-bolt group-hover:animate-pulse"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Estado: Cargando (Overlay) -->
        <div id="loading-container" class="fixed inset-0 bg-slate-900 bg-opacity-90 z-50 flex flex-col items-center justify-center hidden backdrop-blur-sm">
            <div class="relative">
                <div class="w-20 h-20 border-4 border-slate-700 border-t-purple-500 rounded-full animate-spin"></div>
                <div class="absolute inset-0 flex items-center justify-center">
                    <i class="fas fa-brain text-purple-500 text-xl animate-pulse"></i>
                </div>
            </div>
            <h3 class="text-2xl font-bold text-white mt-6 animate-pulse">Procesando Datos...</h3>
            <p class="text-slate-400 mt-2">Cruzando estrategia con evidencia visual</p>
        </div>

        <!-- Estado: Error -->
        <div id="error-container" class="hidden mt-8 max-w-2xl mx-auto bg-red-900/20 border border-red-500/50 text-red-200 p-4 rounded-xl flex items-start gap-3">
            <i class="fas fa-exclamation-circle mt-1 text-red-500"></i>
            <div>
                <h3 class="font-bold">Error en el sistema</h3>
                <p id="error-message" class="text-sm opacity-80"></p>
            </div>
        </div>

        <!-- Resultados -->
        <div id="results-container" class="hidden mt-12 space-y-8 pb-12">
            
            <!-- Separador -->
            <div class="flex items-center gap-4">
                <div class="h-px bg-slate-700 flex-grow"></div>
                <h2 class="text-2xl font-bold text-white">Informe Generado</h2>
                <div class="h-px bg-slate-700 flex-grow"></div>
            </div>

            <!-- Resumen Top -->
            <div class="glass-panel p-8 rounded-2xl relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10">
                    <i class="fas fa-quote-right text-6xl text-purple-500"></i>
                </div>
                <h3 class="text-purple-400 font-bold text-sm tracking-wide uppercase mb-2">Veredicto General</h3>
                <p id="overall-summary" class="text-xl md:text-2xl font-light text-slate-100 leading-relaxed"></p>
            </div>

            <!-- Grid de Tarjetas -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Tarjetas se inyectan aquí -->
                <div id="profile-card"></div>
                <div id="visuals-card"></div>
                <div id="content-card"></div>
            </div>

            <!-- Botón Reset -->
            <div class="text-center pt-8">
                <button id="reset-button" class="px-8 py-3 rounded-full border border-slate-600 text-slate-300 hover:bg-slate-800 hover:text-white transition flex items-center gap-2 mx-auto">
                    <i class="fas fa-redo"></i> Nuevo Análisis
                </button>
            </div>
        </div>

    </div>

    <script type_name="module">
        // ==================================================================
        // CONFIGURACIÓN
        // ==================================================================
        const API_KEY = ""; // <-- ¡PEGA TU CLAVE DE GOOGLE AI STUDIO AQUÍ!
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${AIzaSyA8WSo8oHROM-lI9SxdhC0KK3uwc0mDftg}`;

        // ==================================================================
        // LOGICA DE NEGOCIO (PROMPT)
        // ==================================================================
        
        function buildSystemPrompt(userInputs) {
            return `Eres 'Perfilecto AI', un auditor de marca senior. 
            
CONTEXTO DEL CLIENTE (Lo que ellos dicen ser):
1. Problema que resuelven: "${userInputs.problem}"
2. Diferenciación declarada: "${userInputs.diff}"
3. Público Objetivo declarado: "${userInputs.target}"

TU TAREA:
Analiza la captura de pantalla del perfil de red social proporcionada.
CRUZA la información visual con el "Contexto del Cliente" de arriba. Detecta desconexiones (ej. dicen ser lujo pero la imagen se ve amateur, dicen resolver X pero la bio dice Y).

ESTRUCTURA DE ANÁLISIS:
1. **Coherencia Estratégica (Perfil/Bio)**: ¿La bio comunica el problema y la diferenciación que el usuario declaró? ¿Es claro para el público objetivo mencionado?
2. **Impacto Visual (Branding)**: ¿El estilo visual atrae al público objetivo declarado? (ej. colores corporativos vs divertidos).
3. **Contenido Visible**: ¿Los posts visibles parecen resolver el problema declarado?

Formato de salida: JSON estricto.`;
        }

        const JSON_SCHEMA = {
            "type": "OBJECT",
            "properties": {
                "profileAnalysis": {
                    "type": "OBJECT",
                    "properties": {
                        "score": { "type": "NUMBER" },
                        "positives": { "type": "STRING" },
                        "negatives": { "type": "STRING", "description": "Enfócate en si la bio refleja la Propuesta de Valor declarada." },
                        "recommendation": { "type": "STRING" }
                    }
                },
                "visualIdentity": {
                    "type": "OBJECT",
                    "properties": {
                        "score": { "type": "NUMBER" },
                        "positives": { "type": "STRING" },
                        "negatives": { "type": "STRING" },
                        "recommendation": { "type": "STRING", "description": "Cómo mejorar el look para atraer al Público Objetivo declarado." }
                    }
                },
                "contentStrategy": {
                    "type": "OBJECT",
                    "properties": {
                        "score": { "type": "NUMBER" },
                        "positives": { "type": "STRING" },
                        "negatives": { "type": "STRING" },
                        "recommendation": { "type": "STRING" }
                    }
                },
                "overallSummary": {
                    "type": "STRING",
                    "description": "Resumen directo. Menciona si hay una desconexión entre lo que el usuario quiere transmitir y lo que realmente se ve."
                }
            }
        };

        // ==================================================================
        // API HANDLER
        // ==================================================================

        async function callGeminiAPI(base64Image, inputs) {
            if (!API_KEY) throw new Error("Falta la API KEY. Edita el código HTML.");

            const dynamicPrompt = buildSystemPrompt(inputs);

            const payload = {
                "contents": [{
                    "role": "user",
                    "parts": [
                        { "text": "Audita este perfil basándote en mi estrategia." },
                        { "inlineData": { "mimeType": "image/jpeg", "data": base64Image } }
                    ]
                }],
                "systemInstruction": {
                    "parts": [{ "text": dynamicPrompt }]
                },
                "generationConfig": {
                    "responseMimeType": "application/json",
                    "responseSchema": JSON_SCHEMA
                }
            };

            const response = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                const err = await response.json();
                if (response.status === 403) throw new Error("Acceso denegado (403). Verifica tu API Key.");
                throw new Error(err.error?.message || "Error desconocido en la API");
            }

            const result = await response.json();
            return JSON.parse(result.candidates[0].content.parts[0].text);
        }

        // ==================================================================
        // UI LOGIC
        // ==================================================================

        const elements = {
            dropZone: document.getElementById('drop-zone'),
            fileInput: document.getElementById('file-input'),
            dropContent: document.getElementById('drop-content'),
            imagePreview: document.getElementById('image-preview'),
            changeImageBtn: document.getElementById('change-image-btn'),
            analyzeBtn: document.getElementById('analyze-button'),
            resetBtn: document.getElementById('reset-button'),
            inputs: {
                problem: document.getElementById('input-problem'),
                diff: document.getElementById('input-diff'),
                target: document.getElementById('input-target')
            },
            containers: {
                main: document.getElementById('main-interface'),
                loading: document.getElementById('loading-container'),
                results: document.getElementById('results-container'),
                error: document.getElementById('error-container')
            },
            cards: {
                profile: document.getElementById('profile-card'),
                visuals: document.getElementById('visuals-card'),
                content: document.getElementById('content-card'),
                summary: document.getElementById('overall-summary')
            }
        };

        let currentFileBase64 = null;

        // --- Manejo de Drag & Drop e Imagen ---
        
        elements.dropZone.addEventListener('click', (e) => {
            if(e.target !== elements.changeImageBtn && !elements.changeImageBtn.contains(e.target)) {
                elements.fileInput.click();
            }
        });

        elements.dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            elements.dropZone.classList.add('border-purple-500', 'bg-purple-900/20');
        });

        elements.dropZone.addEventListener('dragleave', () => {
            elements.dropZone.classList.remove('border-purple-500', 'bg-purple-900/20');
        });

        elements.dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            elements.dropZone.classList.remove('border-purple-500', 'bg-purple-900/20');
            if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
        });

        elements.fileInput.addEventListener('change', (e) => {
            if (e.target.files.length) handleFile(e.target.files[0]);
        });

        elements.changeImageBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            resetImage();
        });

        function handleFile(file) {
            if (!file.type.startsWith('image/')) {
                showError("Solo se permiten imágenes (PNG, JPG).");
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    currentFileBase64 = resizeImage(img);
                    elements.imagePreview.src = currentFileBase64; // Mostrar preview en base64 directo
                    
                    // UI Updates
                    elements.imagePreview.classList.remove('hidden', 'opacity-0');
                    elements.imagePreview.classList.add('opacity-100');
                    elements.dropContent.classList.add('hidden');
                    elements.changeImageBtn.classList.remove('hidden');
                    
                    // Limpiar solo la parte base64 pura para la API
                    currentFileBase64 = currentFileBase64.split(',')[1];
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function resetImage() {
            currentFileBase64 = null;
            elements.fileInput.value = '';
            elements.imagePreview.classList.add('hidden', 'opacity-0');
            elements.imagePreview.src = '#';
            elements.dropContent.classList.remove('hidden');
            elements.changeImageBtn.classList.add('hidden');
        }

        function resizeImage(img, maxWidth = 1024) {
            const canvas = document.createElement('canvas');
            let width = img.width;
            let height = img.height;
            
            if (width > maxWidth) {
                height = (height * maxWidth) / width;
                width = maxWidth;
            }
            
            canvas.width = width;
            canvas.height = height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, width, height);
            return canvas.toDataURL('image/jpeg', 0.85);
        }

        // --- Manejo del Análisis ---

        elements.analyzeBtn.addEventListener('click', async () => {
            // Validaciones
            if (!currentFileBase64) return showError("Por favor, sube una imagen primero.");
            
            const inputs = {
                problem: elements.inputs.problem.value.trim(),
                diff: elements.inputs.diff.value.trim(),
                target: elements.inputs.target.value.trim()
            };

            if (!inputs.problem || !inputs.diff || !inputs.target) {
                return showError("Por favor, completa los 3 campos de estrategia. Son vitales para la IA.");
            }

            // Iniciar proceso
            elements.containers.error.classList.add('hidden');
            elements.containers.loading.classList.remove('hidden');
            
            try {
                const data = await callGeminiAPI(currentFileBase64, inputs);
                renderResults(data);
                
                elements.containers.loading.classList.add('hidden');
                elements.containers.results.classList.remove('hidden');
                
                // Scroll suave a resultados
                elements.containers.results.scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                elements.containers.loading.classList.add('hidden');
                showError(error.message);
            }
        });

        // --- Renderizado ---

        function renderResults(data) {
            elements.cards.summary.textContent = data.overallSummary;
            
            const createCard = (title, icon, data, colorClass) => `
                <div class="glass-panel p-6 rounded-2xl h-full border-t-4 ${colorClass} flex flex-col">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="font-bold text-lg text-white flex items-center gap-2">
                            <i class="${icon}"></i> ${title}
                        </h4>
                        <div class="w-12 h-12 rounded-full bg-slate-700 flex items-center justify-center font-bold text-white border border-slate-600">
                            ${data.score}
                        </div>
                    </div>
                    
                    <div class="space-y-4 flex-grow text-sm">
                        <div>
                            <p class="text-green-400 font-semibold mb-1"><i class="fas fa-check mr-1"></i> Aciertos</p>
                            <p class="text-slate-300">${data.positives}</p>
                        </div>
                        <div>
                            <p class="text-red-400 font-semibold mb-1"><i class="fas fa-times mr-1"></i> Desconexión</p>
                            <p class="text-slate-300">${data.negatives}</p>
                        </div>
                    </div>

                    <div class="mt-6 pt-4 border-t border-slate-700/50">
                         <p class="text-purple-300 text-xs font-bold uppercase mb-1">Acción Recomendada</p>
                         <p class="text-white italic">"${data.recommendation}"</p>
                    </div>
                </div>
            `;

            elements.cards.profile.innerHTML = createCard(
                "Coherencia Bio", "fas fa-id-card", data.profileAnalysis, "border-blue-500"
            );
            elements.cards.visuals.innerHTML = createCard(
                "Impacto Visual", "fas fa-eye", data.visualIdentity, "border-purple-500"
            );
            elements.cards.content.innerHTML = createCard(
                "Contenido", "fas fa-photo-video", data.contentStrategy, "border-pink-500"
            );
        }

        function showError(msg) {
            document.getElementById('error-message').textContent = msg;
            elements.containers.error.classList.remove('hidden');
        }

        // --- Reset ---
        elements.resetBtn.addEventListener('click', () => {
            elements.containers.results.classList.add('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
            // Opcional: ¿Limpiar inputs o dejarlos para re-intentar con otra foto? 
            // Dejémoslos por si el usuario quiere corregir la foto pero no reescribir todo.
        });

    </script>
</body>
</html>